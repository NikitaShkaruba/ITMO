Кракозябры при выводе
Несвоевременно переключает режим, есть "некая память", например, пока не нажмёшь кнопку, режим не переключится
Синхронизировать write_max(используются Timer0, опросом DIP-переключателя)
Куда делась память? Странности из-за _xdata